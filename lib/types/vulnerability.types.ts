/**
 * 웹 취약점 분석 API 타입 정의
 * 백엔드 API 문서 기반: /api/analysis/start
 */

/**
 * 취약점 심각도
 */
export type VulnerabilitySeverity = 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW';

/**
 * 취약점 유형
 */
export type VulnerabilityType =
  | 'XSS' // Cross-Site Scripting
  | 'SQL_INJECTION' // SQL 인젝션
  | 'CSRF' // Cross-Site Request Forgery
  | 'COMMAND_INJECTION' // 명령어 실행 취약점
  | 'PATH_TRAVERSAL' // 경로 조작 취약점
  | 'XXE' // XML External Entity
  | 'SSRF' // Server-Side Request Forgery
  | 'OPEN_REDIRECT' // 오픈 리다이렉트
  | 'SSTI' // Server-Side Template Injection
  | 'CSP_MISSING' // Content Security Policy 누락
  | 'MIME_SNIFFING' // MIME 타입 스니핑
  | string; // 기타 취약점 유형

/**
 * 개별 취약점 정보
 */
export interface Vulnerability {
  /** 취약점 유형 */
  type: VulnerabilityType;
  /** 심각도 */
  severity: VulnerabilitySeverity;
  /** 탐지된 패턴 */
  pattern: string;
  /** 취약점 상세 설명 */
  details: string;
  /** 탐지 신뢰도 (0.0 ~ 1.0) */
  confidence: number;
  /** 취약점 발견 위치 (선택적) */
  location?: string;
}

/**
 * 웹 취약점 분석 요청
 */
export interface VulnerabilityAnalysisRequest {
  /** 분석할 웹사이트 URL */
  url: string;
}

/**
 * 웹 취약점 분석 응답
 */
export interface VulnerabilityAnalysisResponse {
  /** 분석 성공 여부 */
  success: boolean;
  /** 분석된 URL */
  url: string;
  /** 발견된 취약점 개수 */
  vulnerability_count: number;
  /** 취약점 상세 정보 배열 */
  vulnerabilities: Vulnerability[];
}

/**
 * API 에러 응답
 */
export interface VulnerabilityAnalysisError {
  /** 에러 발생 여부 */
  success: false;
  /** 에러 메시지 */
  message: string;
}

/**
 * 취약점 통계
 */
export interface VulnerabilityStats {
  /** CRITICAL 취약점 개수 */
  critical: number;
  /** HIGH 취약점 개수 */
  high: number;
  /** MEDIUM 취약점 개수 */
  medium: number;
  /** LOW 취약점 개수 */
  low: number;
  /** 전체 취약점 개수 */
  total: number;
}

/**
 * 취약점 심각도별 색상 매핑
 */
export const SEVERITY_COLORS: Record<VulnerabilitySeverity, string> = {
  CRITICAL: '#D32F2F',
  HIGH: '#FF7043',
  MEDIUM: '#FFCA28',
  LOW: '#66BB6A',
};

/**
 * 취약점 유형별 한글 이름 매핑
 */
export const VULNERABILITY_TYPE_NAMES: Record<string, string> = {
  XSS: 'Cross-Site Scripting (XSS)',
  SQL_INJECTION: 'SQL 인젝션',
  CSRF: 'Cross-Site Request Forgery (CSRF)',
  COMMAND_INJECTION: '명령어 실행 취약점',
  PATH_TRAVERSAL: '경로 조작 취약점',
  XXE: 'XML External Entity (XXE)',
  SSRF: 'Server-Side Request Forgery (SSRF)',
  OPEN_REDIRECT: '오픈 리다이렉트',
  SSTI: 'Server-Side Template Injection',
  CSP_MISSING: 'CSP 헤더 누락',
  MIME_SNIFFING: 'MIME 스니핑 취약점',
};

/**
 * 취약점 유형별 해결 방법
 */
export const VULNERABILITY_SOLUTIONS: Record<string, string[]> = {
  XSS: [
    '입력값 검증 및 출력 인코딩',
    'Content-Security-Policy 헤더 설정',
    'HttpOnly, Secure 쿠키 플래그 사용',
    'XSS 방어 라이브러리 사용 (DOMPurify 등)',
  ],
  SQL_INJECTION: [
    'Prepared Statement 사용',
    '파라미터 바인딩 적용',
    '입력값 검증 및 이스케이프 처리',
    'ORM 프레임워크 사용 권장',
  ],
  CSRF: [
    'CSRF 토큰 구현',
    'SameSite 쿠키 속성 설정',
    'Referer 헤더 검증',
    '중요 작업에 재인증 요구',
  ],
  COMMAND_INJECTION: [
    '사용자 입력으로 시스템 명령 실행 금지',
    '화이트리스트 기반 입력 검증',
    '쉘 메타문자 이스케이프 처리',
    '최소 권한 원칙 적용',
  ],
  PATH_TRAVERSAL: [
    '파일 경로 정규화 및 검증',
    '화이트리스트 기반 경로 제한',
    '상대 경로 사용 금지',
    '웹 루트 외부 접근 차단',
  ],
  XXE: [
    'XML 외부 엔티티 비활성화',
    '안전한 XML 파서 사용',
    'XML 입력 검증',
    'JSON 등 대체 포맷 사용 고려',
  ],
  SSRF: [
    '내부 IP 주소 접근 차단',
    'URL 화이트리스트 검증',
    '리다이렉트 제한',
    '네트워크 레벨 접근 제어',
  ],
  OPEN_REDIRECT: [
    '리다이렉트 URL 화이트리스트 검증',
    '외부 URL 리다이렉트 제한',
    '사용자 확인 단계 추가',
    '상대 경로만 허용',
  ],
  SSTI: [
    '템플릿 엔진 샌드박스 활성화',
    '사용자 입력을 템플릿에 직접 사용 금지',
    '안전한 템플릿 렌더링 함수 사용',
    '입력값 검증 및 이스케이프',
  ],
  CSP_MISSING: [
    'Content-Security-Policy 헤더 설정',
    '인라인 스크립트 제한',
    'nonce 또는 hash 기반 스크립트 허용',
    '외부 리소스 로드 제한',
  ],
  MIME_SNIFFING: [
    'X-Content-Type-Options: nosniff 헤더 설정',
    '올바른 Content-Type 헤더 설정',
    '파일 업로드 검증 강화',
    '파일 확장자 화이트리스트 적용',
  ],
};
